<% content_for(:title, "#{@user.name || @user.username}'s profile - Betterboxd") %>

<div class="flex flex-col gap-6">
  <section class="flex items-center gap-4">
    <div class="flex-shrink-0">
      <div class="w-24 h-24 bg-gray-300 rounded-full flex items-center justify-center">
        <span class="text-gray-600 text-2xl font-bold">
          <%= @user.first_name&.first&.upcase + @user.last_name.first.upcase %>
        </span>
      </div>
    </div>
    
    <div class="flex-1">      
      <h1 class="text-white text-3xl font-bold">
        <%= @user.name || @user.username %>
      </h1>
      
      <div class="flex gap-4 text-sm text-gray-300 mb-2">
        <span><%= @user.following_count %> Following</span>
        <span><%= @user.followers_count %> Followers</span>
      </div>
      
      <div class="flex gap-6">
        <% if @user.location.present? %>
          <span class="inline-flex items-center">
            üìç <%= @user.location %>
          </span>
        <% end %>
      
      <% if @user.website.present? %>
        <a href="<%= @user.website %>" target="_blank" rel="noopener" class="link">
          üîó <%= @user.website %>
        </a>
      <% end %>
      </div>
      
      <% if Current.user && Current.user != @user %>
        <div class="mt-3">
          <% if Current.user.following?(@user) %>
            <%= button_to "Unfollow",
              unfollow_user_path(@user.username), 
              method: :delete, 
              class: "btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm",
              data: { confirm: "Are you sure you want to unfollow @#{@user.username}?" }
            %>
          <% else %>
            <%= button_to "Follow",
              follow_user_path(@user.username), 
              method: :post, 
              class: "btn btn-primary px-4 py-2 rounded-md text-sm"
            %>
          <% end %>
        </div>
      <% end %>
    </div>
  </section>

  <% if @user.bio.present? %>
    <section class="max-w-42">
      <h2 class="section-heading">Bio</h2>
      <p>
        <%= simple_format(@user.bio) %>
      </p>
    </section>
  <% end %>

  <% if @user.reviews.present? %>
    <section>
      <h1 class="section-heading">
        Recent reviews
      </h1>
      <ul class="space-y-4">
        <% @reviews.each do |review| %>
          <li>
            <%=
              render 'application/review_list_item',
                locals: {
                  review: review,
                  movie: review.movie,
                  user: @user
                }
            %>
          </li>
        <% end %>
      </ul>
    </section>
  <% end %>
</div>
